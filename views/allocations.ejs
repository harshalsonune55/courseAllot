<div class="px-16 py-10 bg-gray-100 min-h-screen">

   
    <div class="mb-8">
      <input 
        type="text"
        placeholder="Search courses, faculty, allocations..."
        class="w-full border-2 border-gray-300 rounded-xl px-6 py-4 focus:ring-2 focus:ring-blue-600 focus:outline-none"
      />
    </div>
  

    <div class="bg-blue-950 text-white rounded-2xl p-8 flex justify-between items-center mb-10">
      <div>
        <h2 class="text-2xl font-semibold">Request New Allocation</h2>
        <p class="text-gray-300 mt-2">
          Select a course you'd like to teach and submit your request for approval
        </p>
      </div>
      <button onclick="openModal()" 
  class="bg-white text-blue-950 px-6 py-3 rounded-xl font-medium hover:bg-gray-200">
  âœ¨ Request Course
</button>

    </div>
  

    <div class="bg-white border-2 border-gray-300 rounded-2xl p-8 shadow-sm">
  
      <h3 class="text-xl font-semibold mb-6 text-gray-800">
        My Course Allocations & Preferences
      </h3>

<div class="mb-10">

    <% if (data.recommendations && data.recommendations.length > 0) { %>
  
      <% data.recommendations.forEach(course => { %>
  
        <div class="bg-gray-50 border rounded-xl p-6 flex justify-between items-center mb-6">
  
          <div>
            <h5 class="text-lg font-semibold"><%= course.course %></h5>
            <p class="text-gray-600">AI Match Score</p>
            <p class="text-green-700 mt-2 text-sm">
              AI Match: <%= course.score %>%
            </p>
          </div>
  
          <%
  const request = data.requests.find(r => r.courseName === course.course);
%>

<% if(request && request.status === "APPROVED"){ %>
  <span class="bg-green-700 text-white px-4 py-2 rounded-full text-sm">
    APPROVED
  </span>

<% } else if(request && request.status === "REJECTED"){ %>
  <span class="bg-red-600 text-white px-4 py-2 rounded-full text-sm">
    REJECTED
  </span>

<% } else if(request && request.status === "PENDING"){ %>
  <span class="bg-blue-950 text-white px-4 py-2 rounded-full text-sm">
    PENDING
  </span>

<% } else { %>
  <span class="bg-gray-300 text-gray-700 px-4 py-2 rounded-full text-sm">
    Not Requested
  </span>
<% } %>

  
        </div>
  
      <% }) %>
  
    <% } else { %>
  
      <div class="bg-yellow-50 border border-yellow-200 text-yellow-900 p-6 rounded-xl">
        No AI recommendations yet. Please upload your CV first.
      </div>
  
    <% } %>
  
  </div>
  
  
      <hr class="my-8">
  

    <div>
      <h4 class="text-lg font-semibold text-gray-800 mb-6">
        âœ¨ AI Suggested Courses (Based on Your CV)
      </h4>
    
      <% if (data.recommendations && data.recommendations.length > 0) { %>
    
        <% data.recommendations.forEach(course => { %>
    
          <div class="bg-gray-50 border-2 border-gray-200 rounded-2xl p-6 mb-4">
    
            <div class="flex justify-between items-center">
    
              <div>
                <h5 class="text-lg font-semibold">
                  <%= course.course %>
                </h5>
    
                <p class="text-gray-600 mt-2">
                  AI Match Score: 
                  <span class="text-green-700 font-semibold">
                    <%= course.score %>%
                  </span>
                </p>
    
                <% if(course.score >= 80){ %>
                  <p class="text-green-700 text-sm mt-2">
                    Highly Recommended
                  </p>
                <% } else if(course.score >= 60){ %>
                  <p class="text-yellow-600 text-sm mt-2">
                    Good Match
                  </p>
                <% } else { %>
                  <p class="text-gray-500 text-sm mt-2">
                    Moderate Match
                  </p>
                <% } %>
              </div>
    
            </div>
    
          </div>
    
        <% }) %>
    
      <% } else { %>
    
        <div class="bg-yellow-50 border border-yellow-200 text-yellow-900 p-6 rounded-xl">
          Upload your CV to see AI-powered course suggestions.
        </div>
    
      <% } %>
    </div>
    


</div>



</div>

<div id="requestModal"
     class="fixed inset-0 flex items-center justify-center hidden z-50">

  <div class="bg-white w-[650px] rounded-3xl shadow-2xl p-10 relative">

    <button onclick="closeModal()"
      class="absolute top-6 right-6 bg-gray-100 w-12 h-12 rounded-xl flex items-center justify-center text-gray-600 hover:bg-gray-200 text-2xl">
      âœ•
    </button>

    <h2 class="text-3xl font-semibold mb-8">
      Request Course Allocation
    </h2>

    <div class="bg-green-50 border border-green-300 text-green-800 p-6 rounded-2xl mb-8">
      âœ¨ AI will calculate your compatibility score with the course
    </div>

  
    <form action="/request-course" method="POST">

      <div class="mb-8">
        <label class="block text-lg font-medium mb-3">Select Course</label>
    
        <select name="courseName" id="courseSelect"
          class="w-full border-2 border-blue-600 rounded-2xl px-6 py-4 text-lg focus:outline-none"
          required>
    
          <option value="">-- Select Course --</option>
          <% data.recommendations.forEach(course => { %>
            <option value="<%= course.course %>">
              <%= course.course %> (<%= course.score %>% Match)
            </option>
          <% }) %>
    
        </select>
      </div>
    
      <!-- ðŸ”¹ NEW COMMENT SECTION -->
      <div class="mb-8">
        <label class="block text-lg font-medium mb-3">
          Comment to HOD (Optional)
        </label>
    
        <textarea name="comment"
          rows="4"
          placeholder="Explain why you would like to teach this course..."
          class="w-full border-2 border-gray-300 rounded-2xl px-6 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-blue-600 resize-none"></textarea>
    
        <p class="text-sm text-gray-500 mt-2">
          Example: I have 5 years experience teaching this subject and completed advanced research in this area.
        </p>
      </div>
    
      <input type="hidden" name="score" id="aiScoreInput">
    
      <div class="flex gap-6">
        <button type="button" onclick="closeModal()"
          class="w-1/2 bg-gray-200 py-4 rounded-2xl text-lg font-medium hover:bg-gray-300">
          Cancel
        </button>
    
        <button type="submit"
          class="w-1/2 bg-blue-950 text-white py-4 rounded-2xl text-lg font-medium">
          âœ¨ Submit Request
        </button>
      </div>
    
    </form>
    

  </div>
</div>


  </div>
</div>

  
</div>
  
 
  <script>
    const checkboxes = document.querySelectorAll('.course-checkbox');
    const cards = document.querySelectorAll('.course-card');
    const saveBtn = document.getElementById('saveBtn');
  
    function updateSelection() {
      let selectedCount = 0;
  
      checkboxes.forEach((checkbox, index) => {
        const circle = cards[index].querySelector('.selection-circle');
  
        if (checkbox.checked) {
          selectedCount++;
          cards[index].classList.add('border-blue-950');
          circle.classList.add('bg-blue-950');
          circle.classList.remove('border-gray-400');
        } else {
          cards[index].classList.remove('border-blue-950');
          circle.classList.remove('bg-blue-950');
          circle.classList.add('border-gray-400');
        }
      });
  
      saveBtn.textContent = `âœ¨ Save Preferences (${selectedCount} selected)`;
  
      if (selectedCount > 0) {
        saveBtn.classList.remove('opacity-70', 'cursor-not-allowed');
      } else {
        saveBtn.classList.add('opacity-70', 'cursor-not-allowed');
      }
    }
  
    checkboxes.forEach(checkbox => {
      checkbox.addEventListener('change', updateSelection);
    });
  </script>
  
  <script>
    const modal = document.getElementById("requestModal");
    const select = document.getElementById("courseSelect");
    const submitBtn = document.getElementById("submitBtn");
  
    function openModal() {
      modal.classList.remove("hidden");
    }
  
    function closeModal() {
      modal.classList.add("hidden");
      select.value = "";
      submitBtn.classList.add("bg-gray-300", "text-gray-600", "cursor-not-allowed");
      submitBtn.classList.remove("bg-blue-950", "text-white");
    }
  
    select.addEventListener("change", function() {
      if (select.value !== "") {
        submitBtn.classList.remove("bg-gray-300", "text-gray-600", "cursor-not-allowed");
        submitBtn.classList.add("bg-blue-950", "text-white");
      } else {
        submitBtn.classList.add("bg-gray-300", "text-gray-600", "cursor-not-allowed");
        submitBtn.classList.remove("bg-blue-950", "text-white");
      }
    });
  </script>
  <script>
    const recommendations = <%- JSON.stringify(data.recommendations || []) %>;
  
    const select = document.getElementById("courseSelect");
    const scoreInput = document.getElementById("aiScoreInput");
  
    select.addEventListener("change", function () {
      const selectedCourse = select.value;
  
      const found = recommendations.find(r => r.course === selectedCourse);
  
      if (found) {
        scoreInput.value = found.score;
      } else {
        scoreInput.value = 50; 
      }
    });
  </script>
  